---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "konnect_event_gateway_listener_policy_forward_to_virtual_cluster Resource - terraform-provider-konnect"
subcategory: ""
description: |-
  EventGatewayListenerPolicyForwardToVirtualCluster Resource
---

# konnect_event_gateway_listener_policy_forward_to_virtual_cluster (Resource)

EventGatewayListenerPolicyForwardToVirtualCluster Resource

## Example Usage

```terraform
resource "konnect_event_gateway_listener_policy_forward_to_virtual_cluster" "my_eventgatewaylistenerpolicyforwardtovirtualcluster" {
  after  = "5cdefdab-5308-4634-9a15-44d91bca4c50"
  before = "9911945e-114e-447e-a62a-21750214dc32"
  config = {
    sni = {
      advertised_port = 61579
      broker_host_format = {
        type = "per_cluster_suffix"
      }
      sni_suffix = ".example.com"
    }
  }
  description = "...my_description..."
  enabled     = false
  gateway_id  = "9524ec7d-36d9-465d-a8c5-83a3c9390458"
  labels = {
    key = "value"
  }
  listener_id = "bdaf2651-42bc-48ec-b29f-f4890f7f07fc"
  name        = "...my_name..."
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `config` (Attributes) The configuration of the policy. (see [below for nested schema](#nestedatt--config))
- `gateway_id` (String) The UUID of your Gateway.
- `listener_id` (String) The ID of the Event Gateway Listener.

### Optional

- `after` (String) Determines the id of the existing policy the new policy should be inserted after. Either 'before' or 'after' can be provided, when both are omitted the new policy is added to the end of the chain. When both are provided, the request fails with a 400 Bad Request. Requires replacement if changed.
- `before` (String) Determines the id of the existing policy the new policy should be inserted before. Either 'before' or 'after' can be provided, when both are omitted the new policy is added to the end of the chain. When both are provided, the request fails with a 400 Bad Request. Requires replacement if changed.
- `description` (String) A human-readable description of the policy. Default: ""
- `enabled` (Boolean) Whether the policy is enabled. Default: true
- `labels` (Map of String) Labels store metadata of an entity that can be used for filtering an entity list or for searching across entity types. 

Keys must be of length 1-63 characters, and cannot start with "kong", "konnect", "mesh", "kic", or "_".
- `name` (String) A unique user-defined name of the policy.

### Read-Only

- `created_at` (String) An ISO-8601 timestamp representation of entity creation date.
- `id` (String) The unique identifier of the policy.
- `parent_policy_id` (String) The unique identifier of the parent policy, if any.
- `updated_at` (String) An ISO-8601 timestamp representation of entity update date.

<a id="nestedatt--config"></a>
### Nested Schema for `config`

Optional:

- `port_mapping` (Attributes) The configuration to forward request to `destination` and rewrite ports accordingly.
All broker ids must fit in the range of ports defined in the listener, if it doesn't the metadata request will
return an error.

For example with ports: [9000, "9092-9094", "9100"] and `bootstrap_port: at_start` and brokers with ids
1, 2, 3, 4 we will map: bootstrap to 9000 broker 1 to 9001, broker 2 to 9002, broker 3 to 9003, and broker 4
to 9004 and fail the metadata request as these ports are not open.

However, with the same configuration but with brokers with ids: 92,93,94,100 we will map: bootstrap to 9000,
broker 92 to 9092, broker 93 to 9093, broker 94 to 9094, and broker 100 to 9100.

In most cases users should use a single range `["9090-9094"] ` and `bootstrap_port: at_start` and connect with
`<host>:9090` as bootstrap server. Being able to use multiple ranges is only useful when when dealing with
gaps in broker ids.

It is strongly discouraged to use port mapping in production. (see [below for nested schema](#nestedatt--config--port_mapping))
- `sni` (Attributes) The configuration to forward requests to virtual clusters configured with SNI routing. (see [below for nested schema](#nestedatt--config--sni))

<a id="nestedatt--config--port_mapping"></a>
### Nested Schema for `config.port_mapping`

Required:

- `advertised_host` (String) Virtual brokers are advertised to clients using this host. Any kind of host supported by kafka can be used. If not defined, it's listen_address. If listen_address is `0.0.0.0` it's the destination IP of the TCP connection.
- `destination` (Attributes) A reference to a virtual cluster. (see [below for nested schema](#nestedatt--config--port_mapping--destination))

Optional:

- `bootstrap_port` (String) If set to `at_start`, the first port will be used as a bootstrap port.
It provides a stable endpoint to use as the bootstrap server for clients, regardless of broker
IDs in the cluster.

Additionally, it offsets all ports by one, so for example, if there are 3 brokers (id=1, id=2, id=3)
then we will use 4 ports: 9092 (bootstrap), 9093 (id=1), 9094 (id=2), 9095 (id=3)
With `none` we will use 3 ports: 9092 (id=1), 9093 (id=2), 9094 (id=3).
Default: "at_start"; must be one of ["none", "at_start"]
- `min_broker_id` (Number) The lowest broker node ID in the cluster. Default: 0

<a id="nestedatt--config--port_mapping--destination"></a>
### Nested Schema for `config.port_mapping.destination`

Optional:

- `virtual_cluster_reference_by_id` (Attributes) Reference a virtual cluster by its unique identifier. (see [below for nested schema](#nestedatt--config--port_mapping--destination--virtual_cluster_reference_by_id))
- `virtual_cluster_reference_by_name` (Attributes) Reference a virtual cluster by its unique name. (see [below for nested schema](#nestedatt--config--port_mapping--destination--virtual_cluster_reference_by_name))

<a id="nestedatt--config--port_mapping--destination--virtual_cluster_reference_by_id"></a>
### Nested Schema for `config.port_mapping.destination.virtual_cluster_reference_by_id`

Required:

- `id` (String) The unique identifier of the virtual cluster.


<a id="nestedatt--config--port_mapping--destination--virtual_cluster_reference_by_name"></a>
### Nested Schema for `config.port_mapping.destination.virtual_cluster_reference_by_name`

Required:

- `name` (String) The name of the virtual cluster.




<a id="nestedatt--config--sni"></a>
### Nested Schema for `config.sni`

Optional:

- `advertised_port` (Number) Virtual brokers are advertised to clients with this port instead of listen_port. Useful when proxy is
behind loadbalancer listening on different port.
- `broker_host_format` (Attributes) Configures DNS names assigned to brokers in virtual clusters.

- `per_cluster_suffix` is the default and allocates one level in the hierarchy for virtual clusters: `broker-{node_id}.{virtual_cluster}.{sni_suffix}`
- `shared_suffix` puts all brokers from every virtual clusters into the same level: `broker-{node_id}-{virtual_cluster}.{sni_suffix}`. This makes it easier to manage certificates for this listener. (see [below for nested schema](#nestedatt--config--sni--broker_host_format))
- `sni_suffix` (String) Optional suffix for TLS SNI validation.

This suffix is concatenated with the virtual cluster "dns.label" label to form the base name for the SNI.
If not provided, the virtual cluster "dns.label" label alone is used as the base name for the SNI.
For example with sni_suffix: `.example.com` and virtual cluster "dns.label" label: `my-cluster`,
the SNI suffix for it is `my-cluster.example.com`.
If "dns.label" label is absent on the virtual cluster, the traffic won't be routed there.

The bootstrap host is `bootstrap.my-cluster.example.com` and then each broker is addressable at `broker-0.my-cluster.example.com`, `broker-1.my-cluster.example.com`, etc.
This means that your deployment needs to have a wildcard certificate for the domain and a DNS resolver that routes `*.my-cluster.example.com` to the proxy.

The accepted format is a DNS subdomain starting with either `.` or `-`. For example, `-keg.example.com`, `.keg.example.com`, `.namespace.svc.cluster.local`, and `.localhost` are all valid,
while `keg.example.com` is not.

<a id="nestedatt--config--sni--broker_host_format"></a>
### Nested Schema for `config.sni.broker_host_format`

Optional:

- `type` (String) Default: "per_cluster_suffix"; must be one of ["per_cluster_suffix", "shared_suffix"]

## Import

Import is supported using the following syntax:

In Terraform v1.5.0 and later, the [`import` block](https://developer.hashicorp.com/terraform/language/import) can be used with the `id` attribute, for example:

```terraform
import {
  to = konnect_event_gateway_listener_policy_forward_to_virtual_cluster.my_konnect_event_gateway_listener_policy_forward_to_virtual_cluster
  id = jsonencode({
    gateway_id = "9524ec7d-36d9-465d-a8c5-83a3c9390458"
    id = "9524ec7d-36d9-465d-a8c5-83a3c9390458"
    listener_id = "..."
  })
}
```

The [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import) can be used, for example:

```shell
terraform import konnect_event_gateway_listener_policy_forward_to_virtual_cluster.my_konnect_event_gateway_listener_policy_forward_to_virtual_cluster '{"gateway_id": "9524ec7d-36d9-465d-a8c5-83a3c9390458", "id": "9524ec7d-36d9-465d-a8c5-83a3c9390458", "listener_id": "..."}'
```
